<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DekWave â€” Puget Sound Navigator</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;0,700;1,300;1,400;1,600&family=Jost:wght@300;400;500&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
:root {
  --bg:        #eeeade;
  --surface:   #f5f1e4;
  --surface2:  #faf8f0;
  --navy:      #1a2738;
  --navy2:     #243348;
  --navy3:     #2e4260;
  --brass:     #b58c28;
  --brass-lt:  #ceaa44;
  --brass-dk:  #8c6a18;
  --fog:       #4a7899;
  --fog-lt:    #6a98ba;
  --text1:     #1a2738;
  --text2:     #485868;
  --text3:     #7a8898;
  --border:    rgba(26,39,56,0.14);
  --border-s:  rgba(26,39,56,0.07);
  --green:     #1e6b3e;
  --amber:     #b07a10;
  --red:       #aa2a1a;
  --panel-w:   260px;
  --rpanel-w:  242px;
}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}
html,body{height:100%;background:var(--bg);color:var(--text1);font-family:'Jost',sans-serif;font-size:13px;line-height:1.5;overflow:hidden;}
#app{display:flex;flex-direction:column;height:100vh;overflow:hidden;}

/* SCROLLBAR */
::-webkit-scrollbar{width:4px;}
::-webkit-scrollbar-track{background:transparent;}
::-webkit-scrollbar-thumb{background:rgba(26,39,56,0.18);border-radius:2px;}
::-webkit-scrollbar-thumb:hover{background:rgba(181,140,40,0.4);}

/* â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#header{
  height:58px;background:var(--navy);border-bottom:2px solid var(--brass-dk);
  display:flex;align-items:center;padding:0 18px;gap:18px;flex-shrink:0;z-index:1000;
}
.brand{display:flex;align-items:center;gap:10px;flex-shrink:0;}
.brand-mark{
  width:36px;height:36px;background:var(--brass);border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-family:'Cormorant Garamond',serif;font-weight:700;font-size:13px;
  letter-spacing:.04em;color:var(--navy);
}
.brand-name{font-family:'Cormorant Garamond',serif;font-weight:700;font-size:22px;letter-spacing:.12em;color:var(--brass);line-height:1;}
.brand-sub{font-size:8px;color:rgba(255,255,255,.4);letter-spacing:.22em;text-transform:uppercase;margin-top:1px;}
.partner-badge{
  display:flex;align-items:center;gap:9px;padding:6px 12px;
  border:1px solid rgba(200,169,110,.28);border-radius:2px;
  background:rgba(200,169,110,.07);flex-shrink:0;
}
.partner-badge-icon{font-size:16px;line-height:1;}
.partner-label{font-size:7.5px;color:var(--brass);letter-spacing:.22em;text-transform:uppercase;}
.partner-name{font-family:'Cormorant Garamond',serif;font-size:13px;color:rgba(255,255,255,.88);letter-spacing:.04em;}
.cond-bar{margin-left:auto;display:flex;align-items:center;gap:18px;}
.cond-item{display:flex;flex-direction:column;align-items:center;gap:1px;}
.cond-lbl{font-size:7.5px;color:rgba(255,255,255,.38);letter-spacing:.22em;text-transform:uppercase;}
.cond-val{font-family:'Share Tech Mono',monospace;font-size:13px;color:var(--brass);}
.cond-div{width:1px;height:26px;background:rgba(200,169,110,.2);}
.gps-row{display:flex;align-items:center;gap:6px;}
.gps-dot{width:8px;height:8px;background:#4caf50;border-radius:50%;animation:gpsblink 2s ease-in-out infinite;}
@keyframes gpsblink{0%,100%{opacity:1;box-shadow:0 0 0 0 rgba(76,175,80,.6);}50%{opacity:.75;box-shadow:0 0 0 5px rgba(76,175,80,0);}}

/* â”€â”€ BODY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#body{display:flex;flex:1;overflow:hidden;min-height:0;}

/* â”€â”€ PANELS (shared) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.side-panel{
  background:var(--surface);display:flex;flex-direction:column;
  overflow:hidden;flex-shrink:0;z-index:200;
  transition:width .3s cubic-bezier(.4,0,.2,1);min-width:0;
}
.side-panel.collapsed{width:0!important;}

#left-panel{
  width:var(--panel-w);border-right:1px solid var(--border);
  overflow-y:auto;overflow-x:hidden;
}
#left-panel>*{min-width:var(--panel-w);}
#left-panel.collapsed{border-right:none;}

#right-panel{width:var(--rpanel-w);border-left:1px solid var(--border);}
#right-panel>*{min-width:var(--rpanel-w);}
#right-panel.collapsed{border-left:none;}

/* Panel sections */
.ps{padding:13px 15px;border-bottom:1px solid var(--border-s);}
.ps-title{font-size:7.5px;color:var(--brass-dk);letter-spacing:.24em;text-transform:uppercase;margin-bottom:10px;}

/* Chart mode buttons */
.chart-btns{display:flex;flex-direction:column;gap:3px;}
.chart-btn{
  display:flex;align-items:center;gap:9px;background:none;border:1px solid transparent;
  color:var(--text2);padding:7px 10px;border-radius:2px;cursor:pointer;
  font-family:'Jost',sans-serif;font-size:12px;text-align:left;
  transition:all .18s;width:100%;
}
.chart-btn:hover{background:rgba(26,39,56,.05);color:var(--text1);}
.chart-btn.active{background:var(--navy);border-color:var(--navy2);color:var(--brass);}
.chart-btn-icon{font-size:14px;width:18px;text-align:center;flex-shrink:0;}

/* Overlay toggles */
.ov-row{display:flex;align-items:center;justify-content:space-between;padding:5px 0;border-bottom:1px solid var(--border-s);}
.ov-row:last-child{border-bottom:none;}
.ov-lbl{font-size:11.5px;color:var(--text2);}
.tog{position:relative;width:34px;height:19px;cursor:pointer;flex-shrink:0;}
.tog input{opacity:0;width:0;height:0;position:absolute;}
.tog-track{position:absolute;inset:0;background:rgba(26,39,56,.1);border:1px solid rgba(26,39,56,.2);border-radius:10px;transition:.25s;}
.tog-thumb{position:absolute;top:2px;left:2px;width:13px;height:13px;background:var(--text3);border-radius:50%;transition:.25s;}
.tog input:checked~.tog-track{background:rgba(26,39,56,.15);border-color:var(--navy);}
.tog input:checked~.tog-track .tog-thumb{transform:translateX(15px);background:var(--navy);}

/* Readout grid */
.readout-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px;}
.r-cell{background:var(--surface2);border:1px solid var(--border-s);border-radius:2px;padding:8px 9px;}
.r-lbl{font-size:7.5px;color:var(--text3);letter-spacing:.16em;text-transform:uppercase;margin-bottom:3px;}
.r-val{font-family:'Share Tech Mono',monospace;font-size:17px;color:var(--navy2);line-height:1;}
.r-unit{font-size:9px;color:var(--text3);}

/* Status list */
.st-row{display:flex;align-items:center;gap:8px;padding:5px 0;border-bottom:1px solid var(--border-s);}
.st-row:last-child{border-bottom:none;}
.st-dot{width:6px;height:6px;border-radius:50%;flex-shrink:0;}
.st-dot.g{background:var(--green);}
.st-dot.a{background:var(--amber);}
.st-lbl{font-size:11px;color:var(--text2);flex:1;}
.st-val{font-family:'Share Tech Mono',monospace;font-size:10px;color:var(--fog);}

/* Tide */
.tide-cell{background:var(--surface2);border:1px solid var(--border-s);border-radius:2px;padding:9px;margin-bottom:8px;}
.tide-note{font-size:9.5px;color:var(--text3);line-height:1.55;font-style:italic;}

/* Fishing conditions */
.fc-row{display:flex;align-items:center;gap:10px;padding:5px 0;border-bottom:1px solid var(--border-s);}
.fc-row:last-child{border-bottom:none;}
.fc-icon{font-size:15px;width:20px;text-align:center;flex-shrink:0;}
.fc-lbl{font-size:11px;color:var(--text2);flex:1;}
.fc-val{font-family:'Share Tech Mono',monospace;font-size:10px;}
.fc-val.good{color:var(--green);}
.fc-val.fair{color:var(--amber);}
.fc-val.poor{color:var(--red);}

/* Season chips */
.season-grid{display:grid;grid-template-columns:1fr 1fr;gap:5px;}
.s-chip{background:var(--surface2);border:1px solid var(--border-s);border-radius:2px;padding:6px 8px;}
.s-chip.on{border-color:rgba(30,107,62,.3);background:rgba(30,107,62,.06);}
.s-chip-name{font-size:10px;color:var(--navy);font-weight:500;margin-bottom:1px;}
.s-chip.on .s-chip-name{color:var(--green);}
.s-chip-info{font-size:9px;color:var(--text3);}

/* Fishing spot quick-list */
.spot-row{
  display:flex;align-items:center;gap:8px;padding:7px 0;
  border-bottom:1px solid var(--border-s);cursor:pointer;transition:background .15s;
}
.spot-row:last-child{border-bottom:none;}
.spot-row:hover{background:rgba(26,39,56,.04);margin:0 -15px;padding-left:15px;padding-right:15px;}
.spot-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0;}
.spot-name{font-size:11px;color:var(--text1);flex:1;}
.spot-species{font-size:9.5px;color:var(--text3);}

/* â”€â”€ PANEL TOGGLE TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.panel-tab{
  width:16px;background:var(--surface);display:flex;flex-direction:column;
  align-items:center;justify-content:center;cursor:pointer;flex-shrink:0;
  z-index:300;transition:background .18s;user-select:none;
}
.panel-tab:hover{background:var(--navy);}
.panel-tab:hover .tab-chevron{color:var(--brass);}
.ltab{border-right:1px solid var(--border);}
.rtab{border-left:1px solid var(--border);}
.tab-chevron{
  font-family:'Share Tech Mono',monospace;font-size:11px;
  color:var(--brass-dk);line-height:1;
  writing-mode:vertical-rl;text-orientation:mixed;
  padding:6px 0;
}

/* â”€â”€ MAP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#map-wrap{flex:1;position:relative;overflow:hidden;min-width:0;min-height:0;}
#map{position:absolute;inset:0;}

/* HUD */
#hud{
  position:absolute;bottom:22px;left:50%;transform:translateX(-50%);
  background:rgba(26,39,56,.9);backdrop-filter:blur(14px);
  border:1px solid rgba(200,169,110,.22);border-radius:2px;
  padding:8px 20px;display:flex;align-items:center;gap:20px;
  z-index:800;pointer-events:none;
}
.hud-item{display:flex;flex-direction:column;align-items:center;gap:2px;}
.hud-lbl{font-size:7px;color:rgba(255,255,255,.35);letter-spacing:.22em;text-transform:uppercase;}
.hud-val{font-family:'Share Tech Mono',monospace;font-size:12px;color:var(--brass);white-space:nowrap;}
.hud-div{width:1px;height:26px;background:rgba(200,169,110,.2);}

/* â”€â”€ RIGHT PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.rp-head{padding:13px 15px 11px;border-bottom:1px solid var(--border);flex-shrink:0;}
.rp-head-sub{font-size:10.5px;color:var(--text3);margin-top:2px;}
.poi-list{overflow-y:auto;flex:1;}
.poi-item{padding:10px 14px;border-bottom:1px solid var(--border-s);cursor:pointer;transition:background .16s;}
.poi-item:hover{background:rgba(26,39,56,.04);}
.poi-item.partner{border-left:2px solid var(--brass);padding-left:12px;}
.poi-cat{font-size:8px;color:var(--brass-dk);letter-spacing:.2em;text-transform:uppercase;margin-bottom:2px;}
.poi-name{font-family:'Cormorant Garamond',serif;font-size:14.5px;color:var(--navy);line-height:1.15;margin-bottom:1px;}
.poi-sub{font-size:9.5px;color:var(--text3);}

/* â”€â”€ LEAFLET OVERRIDES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.leaflet-container{background:var(--bg)!important;font-family:'Jost',sans-serif!important;}
.leaflet-popup-content-wrapper{
  background:var(--surface2)!important;border:1px solid var(--border)!important;
  border-radius:2px!important;box-shadow:0 8px 32px rgba(26,39,56,.18)!important;
  color:var(--text1)!important;font-family:'Jost',sans-serif!important;
}
.leaflet-popup-tip{background:var(--surface2)!important;box-shadow:none!important;}
.leaflet-popup-content{margin:0!important;}
.leaflet-popup-close-button{color:var(--text3)!important;font-size:18px!important;right:8px!important;top:8px!important;padding:0!important;}
.leaflet-popup-close-button:hover{color:var(--navy)!important;background:none!important;}
.leaflet-control-zoom{border:1px solid var(--border)!important;border-radius:2px!important;overflow:hidden;box-shadow:0 2px 8px rgba(26,39,56,.12)!important;}
.leaflet-control-zoom a{background:var(--surface2)!important;color:var(--navy)!important;border-bottom:1px solid var(--border)!important;font-size:16px!important;font-weight:300!important;line-height:26px!important;width:26px!important;height:26px!important;}
.leaflet-control-zoom a:last-child{border-bottom:none!important;}
.leaflet-control-zoom a:hover{background:var(--navy)!important;color:var(--brass)!important;}
.leaflet-control-attribution{background:rgba(240,236,224,.92)!important;color:var(--text3)!important;font-family:'Share Tech Mono',monospace!important;font-size:8px!important;}
.leaflet-control-attribution a{color:var(--brass-dk)!important;}
.leaflet-control-scale-line{background:rgba(240,236,224,.92)!important;border:1px solid rgba(26,39,56,.18)!important;border-top:none!important;color:var(--navy2)!important;font-family:'Share Tech Mono',monospace!important;font-size:9px!important;}

/* â”€â”€ POPUP CONTENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.pw{padding:15px 17px 13px;min-width:238px;max-width:306px;}
.pw-partner{display:inline-flex;align-items:center;gap:5px;background:rgba(181,140,40,.1);border:1px solid rgba(181,140,40,.35);border-radius:2px;padding:3px 9px;font-size:8.5px;color:var(--brass-dk);letter-spacing:.1em;margin-bottom:8px;}
.pw-cat{font-size:8px;color:var(--brass-dk);letter-spacing:.22em;text-transform:uppercase;margin-bottom:5px;}
.pw-title{font-family:'Cormorant Garamond',serif;font-size:22px;font-weight:600;color:var(--navy);line-height:1.08;margin-bottom:3px;}
.pw-sub{font-size:11px;color:var(--fog);font-style:italic;margin-bottom:10px;}
.pw-div{height:1px;background:var(--border);margin-bottom:10px;}
.pw-body{font-size:11.5px;color:var(--text2);line-height:1.6;margin-bottom:10px;}
.pw-chips{display:flex;flex-wrap:wrap;gap:4px;margin-bottom:10px;}
.pw-chip{padding:2px 8px;border:1px solid var(--border);border-radius:2px;font-size:9px;color:var(--text2);background:var(--surface);letter-spacing:.04em;}
.pw-tip{border-left:2px solid var(--brass);padding:7px 10px;background:rgba(181,140,40,.06);border-radius:0 2px 2px 0;}
.pw-tip-lbl{font-family:'Cormorant Garamond',serif;font-size:9px;color:var(--brass-dk);letter-spacing:.14em;text-transform:uppercase;margin-bottom:3px;}
.pw-tip-body{font-size:11px;color:var(--text2);font-style:italic;line-height:1.55;}

/* â”€â”€ MARKERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.poi-icon{width:32px;height:32px;background:var(--surface2);border:1.5px solid var(--brass);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px;line-height:1;box-shadow:0 2px 8px rgba(26,39,56,.22);cursor:pointer;}
.poi-icon.partner{width:38px;height:38px;background:var(--navy);border-color:var(--brass);font-size:17px;box-shadow:0 3px 14px rgba(26,39,56,.35);}
.vessel-wrap{position:relative;width:42px;height:42px;}
.v-ring{position:absolute;inset:0;border:2px solid var(--brass);border-radius:50%;animation:vpulse 2.8s ease-out infinite;opacity:0;}
.v-ring:nth-child(2){animation-delay:1.1s;}
@keyframes vpulse{0%{transform:scale(.4);opacity:.7;}100%{transform:scale(2.1);opacity:0;}}
.v-dot{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:12px;height:12px;background:var(--navy);border:2px solid var(--brass);border-radius:50%;box-shadow:0 0 8px rgba(181,140,40,.5);z-index:1;}
.fg-label{font-family:'Share Tech Mono',monospace;font-size:9px;color:var(--navy2);text-align:center;line-height:1.4;white-space:nowrap;pointer-events:none;text-shadow:0 1px 3px rgba(255,255,255,.9);}
.fg-sub{font-size:8px;color:var(--fog);}
.wpt-dot{width:10px;height:10px;background:var(--brass);border:1.5px solid var(--navy);border-radius:50%;box-shadow:0 1px 4px rgba(26,39,56,.3);}

/* â”€â”€ MOBILE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media(max-width:800px){
  #left-panel,#right-panel,.ltab,.rtab{display:none;}
  .cond-bar,.partner-badge{display:none;}
}
</style>
</head>
<body>
<div id="app">

<!-- HEADER -->
<header id="header">
  <div class="brand">
    <div class="brand-mark">DW</div>
    <div>
      <div class="brand-name">DEKWAVE</div>
      <div class="brand-sub">Marine EVA Deck Systems</div>
    </div>
  </div>
  <div class="partner-badge">
    <span class="partner-badge-icon">âš“</span>
    <div>
      <div class="partner-label">Proud Partner</div>
      <div class="partner-name">Gig Harbor Marina &amp; Boatyard</div>
    </div>
  </div>
  <div class="cond-bar">
    <div class="cond-item"><div class="cond-lbl">Wind</div><div class="cond-val">SW 12kts</div></div>
    <div class="cond-div"></div>
    <div class="cond-item"><div class="cond-lbl">Tide</div><div class="cond-val" id="hdr-tide">â€”</div></div>
    <div class="cond-div"></div>
    <div class="cond-item"><div class="cond-lbl">Water</div><div class="cond-val">51.3Â°F</div></div>
    <div class="cond-div"></div>
    <div class="cond-item"><div class="cond-lbl">GPS</div><div class="gps-row"><div class="gps-dot"></div><span class="cond-val" style="font-size:11px">LOCK</span></div></div>
    <div class="cond-div"></div>
    <div class="cond-item"><div class="cond-lbl">Moon</div><div class="cond-val" id="hdr-moon" style="font-size:18px;line-height:1">ğŸŒ•</div></div>
  </div>
</header>

<!-- BODY -->
<div id="body">

  <!-- LEFT PANEL -->
  <aside id="left-panel" class="side-panel">

    <div class="ps">
      <div class="ps-title">Chart Mode</div>
      <div class="chart-btns">
        <button class="chart-btn active" onclick="setMode('carto',this)"><span class="chart-btn-icon">ğŸ—º</span> Nautical Street</button>
        <button class="chart-btn" onclick="setMode('satellite',this)"><span class="chart-btn-icon">ğŸ›°</span> Satellite + Labels</button>
        <button class="chart-btn" onclick="setMode('noaa',this)"><span class="chart-btn-icon">ğŸ“¡</span> NOAA Chart</button>
      </div>
    </div>

    <div class="ps">
      <div class="ps-title">Overlays</div>
      <div class="ov-row"><span class="ov-lbl">SeaMark Nav Aids</span><label class="tog"><input type="checkbox" checked onchange="toggleOv('sea',this.checked)"><div class="tog-track"><div class="tog-thumb"></div></div></label></div>
      <div class="ov-row"><span class="ov-lbl">NOAA Chart Overlay</span><label class="tog"><input type="checkbox" onchange="toggleOv('noaaov',this.checked)"><div class="tog-track"><div class="tog-thumb"></div></div></label></div>
      <div class="ov-row"><span class="ov-lbl">Fishing Grounds</span><label class="tog"><input type="checkbox" checked onchange="toggleOv('fish',this.checked)"><div class="tog-track"><div class="tog-thumb"></div></div></label></div>
      <div class="ov-row"><span class="ov-lbl">Points of Interest</span><label class="tog"><input type="checkbox" checked onchange="toggleOv('pois',this.checked)"><div class="tog-track"><div class="tog-thumb"></div></div></label></div>
      <div class="ov-row"><span class="ov-lbl">Waypoints</span><label class="tog"><input type="checkbox" checked onchange="toggleOv('wpts',this.checked)"><div class="tog-track"><div class="tog-thumb"></div></div></label></div>
    </div>

    <div class="ps">
      <div class="ps-title">Fishing Conditions Â· Now</div>
      <div class="fc-row"><span class="fc-icon">ğŸŒŠ</span><span class="fc-lbl">Tide Phase</span><span class="fc-val" id="fc-tide">â€”</span></div>
      <div class="fc-row"><span class="fc-icon">ğŸŒ™</span><span class="fc-lbl">Moon Phase</span><span class="fc-val" id="fc-moon">â€”</span></div>
      <div class="fc-row"><span class="fc-icon">ğŸ£</span><span class="fc-lbl">Fishing Outlook</span><span class="fc-val" id="fc-out">â€”</span></div>
      <div class="fc-row"><span class="fc-icon">ğŸ’¨</span><span class="fc-lbl">Wind / Sea State</span><span class="fc-val fair">FAIR</span></div>
    </div>

    <div class="ps">
      <div class="ps-title">In-Season Now Â· Puget Sound</div>
      <div class="season-grid" id="season-grid"></div>
    </div>

    <div class="ps">
      <div class="ps-title">Hot Spots â€” Quick Nav</div>
      <div id="spot-list"></div>
    </div>

    <div class="ps">
      <div class="ps-title">Vessel â€” Reel Deal</div>
      <div class="readout-grid">
        <div class="r-cell"><div class="r-lbl">SOG</div><div class="r-val">0.0 <span class="r-unit">kts</span></div></div>
        <div class="r-cell"><div class="r-lbl">COG</div><div class="r-val">---<span class="r-unit">Â°</span></div></div>
        <div class="r-cell"><div class="r-lbl">Depth</div><div class="r-val">42 <span class="r-unit">ft</span></div></div>
        <div class="r-cell"><div class="r-lbl">Water</div><div class="r-val">51.3<span class="r-unit">Â°F</span></div></div>
        <div class="r-cell"><div class="r-lbl">Fuel</div><div class="r-val">78 <span class="r-unit">%</span></div></div>
        <div class="r-cell"><div class="r-lbl">Trip</div><div class="r-val">0.0 <span class="r-unit">nm</span></div></div>
      </div>
    </div>

    <div class="ps">
      <div class="ps-title">System Status</div>
      <div class="st-row"><div class="st-dot g"></div><span class="st-lbl">GPS / GNSS</span><span class="st-val">3D FIX</span></div>
      <div class="st-row"><div class="st-dot g"></div><span class="st-lbl">Chart Data</span><span class="st-val">CURRENT</span></div>
      <div class="st-row"><div class="st-dot a"></div><span class="st-lbl">AIS (Simulated)</span><span class="st-val">NO HW</span></div>
      <div class="st-row"><div class="st-dot g"></div><span class="st-lbl">VHF Radio</span><span class="st-val">CH 16</span></div>
      <div class="st-row"><div class="st-dot g"></div><span class="st-lbl">NOAA Weather</span><span class="st-val">WX3</span></div>
    </div>

    <div class="ps">
      <div class="ps-title">Tide Â· Tacoma Narrows</div>
      <div class="tide-cell">
        <div class="r-lbl">Current Level</div>
        <div class="r-val" id="tide-panel">â€”</div>
      </div>
      <div class="tide-note">Simulated M2+S2 model. For navigation always consult official NOAA tide tables at tidesandcurrents.noaa.gov.</div>
    </div>

  </aside>

  <!-- LEFT TAB -->
  <div class="panel-tab ltab" id="ltab" onclick="toggleLeft()" title="Toggle chart panel">
    <span class="tab-chevron" id="ltab-ch">â€¹</span>
  </div>

  <!-- MAP -->
  <div id="map-wrap">
    <div id="map"></div>
    <div id="hud">
      <div class="hud-item"><div class="hud-lbl">Latitude</div><div class="hud-val" id="hud-lat">47Â° 17.700' N</div></div>
      <div class="hud-div"></div>
      <div class="hud-item"><div class="hud-lbl">Longitude</div><div class="hud-val" id="hud-lon">122Â° 31.500' W</div></div>
      <div class="hud-div"></div>
      <div class="hud-item"><div class="hud-lbl">Zoom</div><div class="hud-val" id="hud-zoom">11</div></div>
      <div class="hud-div"></div>
      <div class="hud-item"><div class="hud-lbl">Mode</div><div class="hud-val" id="hud-mode">CARTO</div></div>
    </div>
  </div>

  <!-- RIGHT TAB -->
  <div class="panel-tab rtab" id="rtab" onclick="toggleRight()" title="Toggle POI panel">
    <span class="tab-chevron" id="rtab-ch">â€º</span>
  </div>

  <!-- RIGHT PANEL -->
  <aside id="right-panel" class="side-panel">
    <div class="rp-head">
      <div class="ps-title" style="margin-bottom:2px">Points of Interest</div>
      <div class="rp-head-sub">Click to fly to location</div>
    </div>
    <div class="poi-list" id="poi-list"></div>
  </aside>

</div><!-- #body -->
</div><!-- #app -->

<script>
/* â”€â”€ UTILITY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function toDM(d,isLat){
  const dir=isLat?(d>=0?'N':'S'):(d>=0?'E':'W');
  const a=Math.abs(d),deg=Math.floor(a),min=((a-deg)*60).toFixed(3).padStart(6,'0');
  return deg+'\u00b0 '+min+'\u2019 '+dir;
}

/* â”€â”€ MAP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const map=L.map('map',{center:[47.295,-122.525],zoom:11,zoomControl:false});
L.control.zoom({position:'bottomright'}).addTo(map);
L.control.scale({position:'bottomleft',imperial:true,metric:false,maxWidth:110}).addTo(map);

/* â”€â”€ TILE LAYERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const tiles={
  carto: L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png',
    {maxZoom:19,attribution:'&copy; <a href="https://carto.com/">CARTO</a> &copy; OpenStreetMap contributors',subdomains:'abcd'}),
  satellite: L.layerGroup([
    L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
      {maxZoom:19,attribution:'&copy; Esri'}),
    L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}',
      {maxZoom:19,attribution:'',opacity:.85})
  ]),
  noaa: L.tileLayer('https://tileservice.charts.noaa.gov/tiles/50000_1/{z}/{x}/{y}.png',
    {maxZoom:16,attribution:'&copy; NOAA',errorTileUrl:'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7'})
};
const overlays={
  sea:    L.tileLayer('https://tiles.openseamap.org/seamark/{z}/{x}/{y}.png',{maxZoom:18,attribution:'&copy; OpenSeaMap',errorTileUrl:'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7'}),
  noaaov: L.tileLayer('https://tileservice.charts.noaa.gov/tiles/50000_1/{z}/{x}/{y}.png',{maxZoom:16,attribution:'',opacity:.45,errorTileUrl:'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7'})
};
const fishingGroup=L.layerGroup(),poiGroup=L.layerGroup(),wptGroup=L.layerGroup();

let activeBase='carto';
tiles.carto.addTo(map);
overlays.sea.addTo(map);

const modeLabel={carto:'CARTO',satellite:'SAT',noaa:'NOAA'};

function setMode(mode,btn){
  const seaOn=map.hasLayer(overlays.sea),noaaOn=map.hasLayer(overlays.noaaov);
  if(seaOn)   map.removeLayer(overlays.sea);
  if(noaaOn)  map.removeLayer(overlays.noaaov);
  map.removeLayer(tiles[activeBase]);
  tiles[mode].addTo(map);
  activeBase=mode;
  if(noaaOn) overlays.noaaov.addTo(map);
  if(seaOn)  overlays.sea.addTo(map);
  document.getElementById('hud-mode').textContent=modeLabel[mode];
  document.querySelectorAll('.chart-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
}
function toggleOv(k,on){
  const m={sea:overlays.sea,noaaov:overlays.noaaov,fish:fishingGroup,pois:poiGroup,wpts:wptGroup};
  on?m[k].addTo(map):map.removeLayer(m[k]);
}

/* â”€â”€ PANEL COLLAPSE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let leftOpen=true,rightOpen=true;
function toggleLeft(){
  leftOpen=!leftOpen;
  document.getElementById('left-panel').classList.toggle('collapsed',!leftOpen);
  document.getElementById('ltab-ch').textContent=leftOpen?'â€¹':'â€º';
  setTimeout(()=>map.invalidateSize({animate:false}),320);
}
function toggleRight(){
  rightOpen=!rightOpen;
  document.getElementById('right-panel').classList.toggle('collapsed',!rightOpen);
  document.getElementById('rtab-ch').textContent=rightOpen?'â€º':'â€¹';
  setTimeout(()=>map.invalidateSize({animate:false}),320);
}

/* â”€â”€ HUD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
map.on('mousemove',e=>{
  document.getElementById('hud-lat').textContent=toDM(e.latlng.lat,true);
  document.getElementById('hud-lon').textContent=toDM(e.latlng.lng,false);
});
map.on('zoomend',()=>document.getElementById('hud-zoom').textContent=map.getZoom());

/* â”€â”€ POI DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const POIS=[
  {lat:47.2676,lng:-122.5506,icon:'ğŸ™',partner:false,
   cat:'Marine Life Â· Protected Habitat',name:'The King Octopus',
   sub:'Tacoma Narrows Â· Giant Pacific Octopus Habitat',
   body:'The Giant Pacific Octopus (<em>Enteroctopus dofleini</em>) â€” world\'s largest â€” inhabits Galloping Gertie\'s wreckage at 200\u202fft. Nutrient-rich tidal upwellings fuel growth to 100+\u202flbs. Voted one of the 11 Wonders of Tacoma.',
   chips:['100+ lbs documented','24 ft arm span','200 ft depth','Protected'],
   tip:'Titlow Beach to the south is the premier shore dive. Giant Pacific Octopus are protected throughout Puget Sound â€” observe from distance only.',
   panelCat:'ğŸ™ Marine Life'},
  {lat:47.265,lng:-122.552,icon:'âš“',partner:false,
   cat:'Historic Wreck Â· NRHP 1992',name:'Galloping Gertie Reef',
   sub:'Tacoma Narrows Bridge Â· Collapsed Nov 7, 1940',
   body:'The original Tacoma Narrows Bridge rests at 200\u202fft â€” one of the world\'s most dramatic artificial reefs. Extreme tidal currents hit 8+ mph. Advanced technical diving only.',
   chips:['200 ft depth','Artificial reef','8 mph current','Advanced only'],
   tip:'Slack window: 15â€“20 minutes only. Float line + SMB mandatory. Verify slack with NOAA current tables.',
   panelCat:'âš“ Historic Wreck'},
  {lat:47.3305,lng:-122.5848,icon:'âš“',partner:true,
   cat:'DekWave Partner Â· Full-Service Marina',name:'Gig Harbor Marina & Boatyard',
   sub:'142 Slips Â· Full Haul-Out Â· VHF Ch 09',
   body:'Full-service marina offering haul-out, engine service, and complete refits. DekWave EVA deck installations performed on-site. Diesel, gas, pumpout, 30/50A shore power.',
   chips:['142 slips','VHF Ch 09','Full haul-out','DekWave Install','Diesel & Gas'],
   tip:'Tides Tavern has a private dock â€” best lingcod fish & chips on Puget Sound since 1973.',
   panelCat:'âš“ DekWave Partner'},
  {lat:47.3155,lng:-122.5438,icon:'ğŸŒ²',partner:false,
   cat:'Fishing Â· Shore Access Â· Kelp',name:'Point Defiance',
   sub:'Kelp Forest Â· Coho Corridor Â· Shore Pier',
   body:'Kelp forest holds coho Augustâ€“October and serves as orca travel corridor. Structure 15â€“35\u202fft over rock. Shore pier access at Point Defiance Park.',
   chips:['Kelp 15â€“35ft','Coho Augâ€“Oct','Orca corridor','Shore pier'],
   tip:'Buzz bomb or Stingsilda spoon. Count to 25â€“30\u202fft, work the outer kelp edge at first light. Fish the tide change.',
   panelCat:'ğŸŒ² Fishing'},
  {lat:47.355,lng:-122.487,icon:'ğŸŸ',partner:false,
   cat:'Fishing Â· Structure Â· Bottom',name:'Dalco Passage Wall',
   sub:'Lingcod & Rockfish Â· 60â€“200ft Wall',
   body:'Wall drops 60â€“200+ feet. Prime lingcod and rockfish year-round, copper and quillback in the shallows. Tidal exchange runs hard â€” slack water only.',
   chips:['Lingcod year-round','60â€“200ft','Slack only','3oz lead head'],
   tip:'Never fight this current. Strike hard at bottom â€” lingcod head straight for structure. Short leader, 40\u202flb fluorocarbon.',
   panelCat:'ğŸŸ Fishing'},
  {lat:47.2448,lng:-122.5265,icon:'ğŸ¤¿',partner:false,
   cat:'Diving Â· Protected Marine Area',name:'Titlow Beach',
   sub:'World-Class Shore Dive Â· 7 Known Octopus Dens',
   body:'Seven known Giant Pacific Octopus dens in the protected marine area. Visibility 20â€“45\u202fft. Structure from 15â€“60\u202fft. One of the finest shore dives in the PNW.',
   chips:['7 GPO dens','20â€“45ft vis','Protected','Shore entry'],
   tip:'Incoming tide, first light. Hands completely off â€” GPO will abandon dens for days if disturbed.',
   panelCat:'ğŸ¤¿ Diving'},
  {lat:47.533,lng:-122.488,icon:'â›µ',partner:false,
   cat:'Anchorage Â· State Marine Park',name:'Blake Island Marine Park',
   sub:'Boat Access Only Â· Orca Travel Corridor',
   body:'Old-growth forest, natural beach, and excellent anchorage. State mooring buoys on eastern cove. Regular J, K, L pod transit corridor.',
   chips:['Boat access only','Orca corridor','Mooring buoys','Old-growth'],
   tip:'East cove, anchor 20â€“35\u202fft over sand/mud. South wind builds fast â€” scope well.',
   panelCat:'â›µ Anchorage'},
  {lat:47.2676,lng:-122.5495,icon:'ğŸŒ‰',partner:false,
   cat:'Navigation Hazard Â· Bridge Clearance',name:'Tacoma Narrows Bridge',
   sub:'187ft MHW Clearance Â· Max 7-Knot Current',
   body:'187\u202fft clearance at MHW â€” verify with tide tables. Max 7\u202fknots. Flood NE; ebb SW. Slack: 15â€“20 minutes.',
   chips:['187ft MHW','Max 7 kts','Slack 15â€“20 min','Flood NE/Ebb SW'],
   tip:'Never transit on full current. Time within 1 hour of slack. Salmon fishing the rip lines can be exceptional.',
   panelCat:'ğŸŒ‰ Navigation'},
  {lat:47.245,lng:-122.607,icon:'ğŸ¦€',partner:false,
   cat:'Crabbing Â· Bottomfishing',name:'Fox Island Flats',
   sub:'Dungeness Crab Â· Pacific Halibut Spring',
   body:'Sand and eelgrass flats hold Dungeness 40â€“70\u202fft. Pacific halibut through spring. Manageable current compared to the Narrows.',
   chips:['Dungeness 40â€“70ft','Halibut spring','Eelgrass bottom','Verify WDFW'],
   tip:'Fresh tuna or butter clams. Overnight soak outproduces short soaks. Always verify WDFW Dungeness seasons â€” they shift annually.',
   panelCat:'ğŸ¦€ Crabbing'},
  {lat:47.38,lng:-122.70,icon:'ğŸ¦',partner:false,
   cat:'Shrimping Â· Deep Water',name:'Henderson Bay',
   sub:'Spot Shrimp Â· 250â€“400ft Deep',
   body:'Prime spot shrimp grounds. May opener: 2â€“4 days only. Limit 80/person. Sheltered from most wind directions.',
   chips:['250â€“400ft','80/person','May opener','Cook live'],
   tip:'Lower at first light, retrieve by mid-morning. Cook live same evening â€” quality drops fast.',
   panelCat:'ğŸ¦ Shrimping'}
];

/* â”€â”€ FISHING GROUNDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const FISHING=[
  {lat:47.268,lng:-122.541,name:'Narrows Drift',species:'Chinook',depth:'50â€“80ft',season:'Julâ€“Oct',tech:'Hot Shot / Dodger rig',color:'#8c6a18'},
  {lat:47.316,lng:-122.542,name:'Defiance Kelp',species:'Coho Salmon',depth:'15â€“35ft',season:'Augâ€“Oct',tech:'Buzz bomb',color:'#4a7899'},
  {lat:47.355,lng:-122.487,name:'Dalco Wall',species:'Lingcod',depth:'60â€“200ft',season:'Year-round',tech:'3oz lead head',color:'#8c6a18'},
  {lat:47.245,lng:-122.608,name:'Fox Island',species:'Dungeness Crab',depth:'40â€“70ft',season:'Seasonal',tech:'Crab pot',color:'#4a7899'},
  {lat:47.278,lng:-122.435,name:'Commencement Bay',species:'King Salmon',depth:'40â€“80ft',season:'Julâ€“Oct',tech:'Mooching rig',color:'#8c6a18'}
];

/* â”€â”€ WAYPOINTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const WPTS=[
  {lat:47.310,lng:-122.560,name:'WPT 001',note:'Favorite anchor â€” sand, good holding'},
  {lat:47.290,lng:-122.510,name:'WPT 002',note:'Morning bite location â€” tide rip here'},
  {lat:47.350,lng:-122.540,name:'WPT 003',note:'Good crabbing depth â€” 65ft mud'}
];

/* â”€â”€ SEASON CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const mo=new Date().getMonth();
const SEASONS=[
  {name:'Chinook',months:[6,7,8,9],icon:'ğŸŸ',info:'Julâ€“Oct Â· 50â€“80ft'},
  {name:'Coho',months:[7,8,9],icon:'ğŸ ',info:'Augâ€“Oct Â· Kelp edge'},
  {name:'Lingcod',months:[0,1,2,3,4,5,6,7,8,9,10,11],icon:'ğŸ¦ˆ',info:'Year-round Â· Wall'},
  {name:'Halibut',months:[3,4,5],icon:'ğŸ«“',info:'Aprâ€“Jun Â· Deep flats'},
  {name:'Dungeness',months:[10,11,0,1,2,3],icon:'ğŸ¦€',info:'Novâ€“Apr Â· Seasonal'},
  {name:'Spot Shrimp',months:[4],icon:'ğŸ¦',info:'May only Â· 250â€“400ft'}
];
const sgEl=document.getElementById('season-grid');
SEASONS.forEach(s=>{
  const on=s.months.includes(mo);
  const el=document.createElement('div');
  el.className='s-chip'+(on?' on':'');
  el.innerHTML=`<div class="s-chip-name">${s.icon} ${s.name}</div><div class="s-chip-info">${s.info}</div>`;
  sgEl.appendChild(el);
});

/* â”€â”€ FISHING SPOT QUICK-NAV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const spotColors={'Chinook':'#8c6a18','Coho Salmon':'#4a7899','Lingcod':'#1e6b3e','Dungeness Crab':'#4a7899','King Salmon':'#8c6a18'};
const slEl=document.getElementById('spot-list');
FISHING.forEach(f=>{
  const el=document.createElement('div');
  el.className='spot-row';
  el.innerHTML=`<div class="spot-dot" style="background:${spotColors[f.species]||'#8c6a18'}"></div><div><div class="spot-name">${f.name}</div><div class="spot-species">${f.species} Â· ${f.season}</div></div>`;
  el.addEventListener('click',()=>{
    map.setView([f.lat,f.lng],13,{animate:true,duration:1});
  });
  slEl.appendChild(el);
});

/* â”€â”€ BUILD POI MARKERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function mkPopup(p){
  const badge=p.partner?'<div class="pw-partner">âš“ DekWave Certified Partner</div>':'';
  const chips=p.chips.map(c=>`<span class="pw-chip">${c}</span>`).join('');
  return `<div class="pw">${badge}<div class="pw-cat">${p.cat}</div><div class="pw-title">${p.name}</div><div class="pw-sub">${p.sub}</div><div class="pw-div"></div><div class="pw-body">${p.body}</div><div class="pw-chips">${chips}</div><div class="pw-tip"><div class="pw-tip-lbl">Local Knowledge</div><div class="pw-tip-body">${p.tip}</div></div></div>`;
}

const poiMk=[];
POIS.forEach(p=>{
  const sz=p.partner?[38,38]:[32,32],an=p.partner?[19,19]:[16,16],pa=p.partner?[0,-22]:[0,-18];
  const m=L.marker([p.lat,p.lng],{icon:L.divIcon({html:`<div class="poi-icon${p.partner?' partner':''}">${p.icon}</div>`,className:'',iconSize:sz,iconAnchor:an,popupAnchor:pa})})
    .bindPopup(mkPopup(p),{maxWidth:320,className:'custom-popup'});
  poiMk.push({m,p});
  poiGroup.addLayer(m);
});
poiGroup.addTo(map);

/* â”€â”€ FISHING GROUND CIRCLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
FISHING.forEach(f=>{
  const c=L.circle([f.lat,f.lng],{radius:820,color:f.color,weight:1.8,opacity:.6,dashArray:'7,5',fillColor:f.color,fillOpacity:.07})
    .bindPopup(`<div class="pw" style="min-width:200px"><div class="pw-cat">Fishing Ground</div><div class="pw-title">${f.name}</div><div class="pw-div"></div><div class="pw-chips"><span class="pw-chip">${f.species}</span><span class="pw-chip">${f.depth}</span><span class="pw-chip">${f.season}</span></div><div class="pw-tip"><div class="pw-tip-lbl">Technique</div><div class="pw-tip-body">${f.tech}</div></div></div>`,{maxWidth:260,className:'custom-popup'});
  fishingGroup.addLayer(c);
  fishingGroup.addLayer(L.marker([f.lat,f.lng],{icon:L.divIcon({html:`<div class="fg-label">${f.name}<br><span class="fg-sub">${f.species}</span></div>`,className:'',iconSize:[110,26],iconAnchor:[55,13]}),interactive:false}));
});
fishingGroup.addTo(map);

/* â”€â”€ VESSEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
L.marker([47.3305,-122.5848],{
  icon:L.divIcon({html:'<div class="vessel-wrap"><div class="v-ring"></div><div class="v-ring"></div><div class="v-dot"></div></div>',className:'',iconSize:[42,42],iconAnchor:[21,21],popupAnchor:[0,-24]}),
  zIndexOffset:500
}).bindPopup(`<div class="pw" style="min-width:200px"><div class="pw-cat">Your Vessel</div><div class="pw-title">Reel Deal</div><div class="pw-sub">Moored at Gig Harbor Marina &amp; Boatyard</div><div class="pw-div"></div><div class="pw-chips"><span class="pw-chip">SOG: 0.0 kts</span><span class="pw-chip">Depth: 42ft</span><span class="pw-chip">Fuel: 78%</span></div><div class="pw-tip"><div class="pw-tip-lbl">Notice</div><div class="pw-tip-body">Vessel position simulated at marina berth. Real-time AIS requires dedicated hardware.</div></div></div>`,{maxWidth:290,className:'custom-popup'}).addTo(map);

/* â”€â”€ WAYPOINTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
WPTS.forEach(w=>{
  L.marker([w.lat,w.lng],{icon:L.divIcon({html:'<div class="wpt-dot"></div>',className:'',iconSize:[10,10],iconAnchor:[5,5],popupAnchor:[0,-8]})})
    .bindPopup(`<div class="pw" style="min-width:180px"><div class="pw-cat">Waypoint</div><div class="pw-title">${w.name}</div><div class="pw-div"></div><div class="pw-body">${w.note}</div><div class="pw-chips"><span class="pw-chip">${toDM(w.lat,true)}</span><span class="pw-chip">${toDM(w.lng,false)}</span></div></div>`,{maxWidth:260,className:'custom-popup'})
    .addTo(wptGroup);
});
wptGroup.addTo(map);

/* â”€â”€ RIGHT PANEL LIST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const poiListEl=document.getElementById('poi-list');
POIS.forEach((p,i)=>{
  const el=document.createElement('div');
  el.className='poi-item'+(p.partner?' partner':'');
  el.innerHTML=`<div class="poi-cat">${p.panelCat}</div><div class="poi-name">${p.name}</div><div class="poi-sub">${p.sub}</div>`;
  el.addEventListener('click',()=>{
    map.setView([p.lat,p.lng],13,{animate:true,duration:1.1});
    setTimeout(()=>poiMk[i].m.openPopup(),1200);
  });
  poiListEl.appendChild(el);
});

/* â”€â”€ MOON PHASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function moonPhase(){
  const d=new Date();
  const jd=367*d.getFullYear()-Math.floor(7*(d.getFullYear()+Math.floor((d.getMonth()+10)/12))/4)+Math.floor(275*d.getMonth()/9)+d.getDate()+1721013.5+d.getUTCHours()/24;
  let f=((jd-2451550.1)/29.530588)%1;if(f<0)f+=1;
  if(f<.0625) return{e:'ğŸŒ‘',n:'New Moon',g:'GOOD'};
  if(f<.1875) return{e:'ğŸŒ’',n:'Waxing Crescent',g:'FAIR'};
  if(f<.3125) return{e:'ğŸŒ“',n:'First Quarter',g:'GOOD'};
  if(f<.4375) return{e:'ğŸŒ”',n:'Waxing Gibbous',g:'FAIR'};
  if(f<.5625) return{e:'ğŸŒ•',n:'Full Moon',g:'BEST'};
  if(f<.6875) return{e:'ğŸŒ–',n:'Waning Gibbous',g:'GOOD'};
  if(f<.8125) return{e:'ğŸŒ—',n:'Last Quarter',g:'GOOD'};
  if(f<.9375) return{e:'ğŸŒ˜',n:'Waning Crescent',g:'FAIR'};
  return{e:'ğŸŒ‘',n:'New Moon',g:'GOOD'};
}

/* â”€â”€ TIDE + CONDITIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function update(){
  const h0=new Date().getHours()+new Date().getMinutes()/60;
  const M2=2*Math.PI/12.42,S2=2*Math.PI/12.00;
  const tide =7.0+5.2*Math.cos(M2*h0+1.1)+1.8*Math.cos(S2*h0+0.8);
  const tide2=7.0+5.2*Math.cos(M2*(h0+.08)+1.1)+1.8*Math.cos(S2*(h0+.08)+0.8);
  const rising=tide2>tide,ht=tide.toFixed(1);
  const arrow=rising?'â†‘':'â†“',trend=rising?'Flooding':'Ebbing';
  const rate=Math.abs(tide2-tide)/.08;
  document.getElementById('hdr-tide').textContent=arrow+' '+ht+'ft';
  document.getElementById('tide-panel').innerHTML=ht+' <span class="r-unit">ft â€” '+trend+'</span>';

  let tideCls,tideLabel;
  if(rate<.3){tideCls='good';tideLabel='SLACK';}
  else if(rate<.7){tideCls='good';tideLabel='SLOW';}
  else if(rate<1.2){tideCls='fair';tideLabel='MOD';}
  else{tideCls='poor';tideLabel='FAST';}

  const moon=moonPhase();
  document.getElementById('hdr-moon').textContent=moon.e;
  const fcTide=document.getElementById('fc-tide');
  fcTide.textContent=tideLabel;fcTide.className='fc-val '+tideCls;
  const fcMoon=document.getElementById('fc-moon');
  fcMoon.textContent=moon.n;fcMoon.className='fc-val '+(moon.g==='POOR'?'poor':moon.g==='FAIR'?'fair':'good');
  const outlook=(moon.g==='BEST'&&tideCls!=='poor')?'EXCELLENT':(tideCls==='good'&&moon.g!=='FAIR')?'GOOD':(tideCls==='fair'||moon.g==='FAIR')?'FAIR':'POOR';
  const fcOut=document.getElementById('fc-out');
  fcOut.textContent=outlook;fcOut.className='fc-val '+(outlook==='EXCELLENT'||outlook==='GOOD'?'good':outlook==='FAIR'?'fair':'poor');
}
update();setInterval(update,60000);

/* â”€â”€ INIT HUD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
document.getElementById('hud-lat').textContent=toDM(47.295,true);
document.getElementById('hud-lon').textContent=toDM(-122.525,false);
</script>
</body>
</html>
